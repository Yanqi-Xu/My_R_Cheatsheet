---
title: "My R Cheat Sheet"
author: "Yanqi Xu"
date: "`r Sys.Date()`"
output: 
  html_document:
    mathjax: null
    theme: lumen
    toc: true
    toc_float:
      collapsed: true
      smooth_scroll: true
---
<!-- <style> this is only reference -->
<!--   .kable_wrapper { -->
<!--     display: block; -->
<!--     font-family: sans-serif; -->
<!--     -webkit-font-smoothing: antialiased; -->
<!--     font-size: 100%; -->
<!--     overflow: auto; -->
<!--     width: 1000px; -->
<!--   } -->
<!--   thead { -->
<!--     background-color: rgb(112, 196, 105); -->
<!--     color: white; -->
<!--     font-weight: normal; -->
<!--     padding: 20px 30px; -->
<!--     text-align: center; -->
<!--   } -->
<!--   tbody { -->
<!--     background-color: rgb(238, 238, 238); -->
<!--     color: rgb(111, 111, 111); -->
<!--     padding: 20px 30px; -->
<!--   } -->
<!--   td, th { -->
<!--     padding: 5px; -->
<!--     border: 1px solid #888 !important; -->
<!-- } -->
<!-- </style> -->

<link rel='stylesheet' href='//cdn.jsdelivr.net/npm/hack-font@3.3.0/build/web/hack-subset.css'>

<style>
  .kable_wrapper {
    display: block;
    font-family: sans-serif
  }
  table{
    table-layout: fixed;
    width: 100%;
    border-collapse:collapse;
}
code, kbd, pre, samp {
  font-family: 'Hack', monospace;
}
p code {
  color: #cc00bb;
  background: #fffcfa;
}
td{
    word-wrap:break-word
}
</style>

```{r setup, include=FALSE}
library(knitr)
opts_chunk$set(
  eval = TRUE,
  echo = TRUE,
  warning = FALSE,
  message = FALSE,
  error = FALSE,
  # it's nice to un-collapse df print
  collapse = TRUE,
  comment = "#>",
  dpi = 300
)
options(knitr.kable.NA = '')
library(kableExtra)
```

Hi! Welcome to my data journalism R cheat sheet for cleaning and wrangling data. Just like the [R cheat sheet resources][10] of package-based cheat sheets, Journalists have put out cheat sheets before, like [MaryJo Webster's R cheat sheet][03]. Hat tip to her and her [amazing collection of data journalism resources][04]!

I use this cheat sheet as an index to functions I will likely encounter and use when I am cleaning data, so I am hoping that it can save you some time googling around. Most of the functions listed here are what I collected when cleaning data at the NICAR data library and for the [accountability project][14] at the Investigative Reporting Workshop.

# What's this for?
Much as I use data cleaning functions on a regular basis, the syntax or function names sometimes get fuzzy every once in a while. So I have organized some most frequently used functions to help refresh memories for certain goals in data processing and also pitfalls! Here they are.

# A word about programming
I always think the most important thing to know about functions and to tap into their strengths is to understand what you're dealing with. When I can't write clean code and get it to work, I always take out my pen and pad and jot down what I want to achieve and the end products I wish to have. This basically helps me get a grasp of the object at hand, and break them down into the smallest unit possible, and how these units can form the end products you want. For example, are you trying to  modify a column or add a new column based on an existing column, which are zipped vectors made up of individual elements?

There are, of course, more than one way to **let's not skin a cat**! For example, picture a jumbled field of last name, first name. If you wish to separate the names into different columns, you can either use the `separate()` function to split up the column by a certain character, or you can use regular expression to capture whatever goes before the comma with `str_match("^(.+),")[,2]`, and whatever comes after as  `str_match(",(.+)$")[,2]`. Pick and choose as you wish!

This cheat sheet  doesn't cover the nuts and bolts of R, for which I highly recommend Andrew Ba Tran's tutorial [Journalism with R][02].

[02]: http://learn.r-journalism.com/en/introduction/
[03]: https://mjwebster.github.io/DataJ/R/Rcheat sheet.html
[04]: http://mjwebster.github.io/DataJ/
[05]: https://www.stat.berkeley.edu/~statcur/Workshop2/Presentations/functions.pdf
[06]: https://github.com/r-lib/remotes
[07]: https://swcarpentry.github.io/r-novice-inflammation/02-func-R/
[08]: https://r4ds.had.co.nz/functions.html
[09]: https://github.com/gadenbuie/regexplain
[10]: https://rstudio.com/resources/cheat sheets/
[11]: https://stackoverflow.com/questions/54815607/r-combinations-with-dot-and-pipe-operator
[12]: https://forms.gle/2jQJksuyrZJZJwVX6
[13]: https://docs.google.com/spreadsheets/d/1A8dGFnnEHwiWOif9Eiejlsw3C29PvDM0lef4wMkFZAE/edit#gid=0
[14]: https://investigativereportingworkshop.org/2019/07/10/introducing-the-accountability-project-a-new-resource-for-public-data/
[15]: https://r4ds.had.co.nz/
[16]: https://bookdown.org/yihui/rmarkdown/html-document.html
# Something about libraries
Since other people have spent all this time writing functions and packaged them, we use their functions by calling the package names (which may take developers a lot of time to come up with) first in the R console or scripts. It's important to declare the packages used at the top of your R Markdown or R scripts file, especially if you knit the file (in order to generate a standalone html for the Rmd in a readable format), otherwise it will throw a bunch of errors. 
This also assumes that you have the packages installed already. If you wish to install new packages, use `install.packages("packagename")` first or use the packages pane to manage your packages (by default, the lower right-hand side pane). If you are trying to install a package that is not on CRAN yet and couldn't be installed by using the `install.packages("packagename")` function, use the [remotes][06] package's `remotes::install_github("r-lib/remotes")`. The double colons help you run a function from a certain package, use `{package_name}::{function_name}`. I am sure that you have figured out that `remotes` is on CRAN, so that it can be installed, with the command `install.packages('remotes')`. 

```{r}
library(tidyverse)
```
# Something about functions
Functions are just objects. They exist in those packages!
So if you want ot know more about functions themselves, call them by their names, without parathenses in the console. 
For the documentation, type "?" followed by the function name, will give you its documentation laid out in the help window. Try `?str_split`. 
For how the function was written to make sense of how it's executed, simply type the name of the function. Like `str_split`.
Further Readings:
[Introduction to the R Language Functions, Berkeley Workshop][05]

```{r echo = FALSE}
My_R_cheatsheet <- read_csv("My_R_cheatsheet.csv")

headers <- My_R_cheatsheet %>% filter(rowSums(is.na(My_R_cheatsheet))==4)

headers <- headers %>% mutate(sections = coalesce(headers[[1]],headers[[3]]))
# my original spreadsheet was created to include columns that will be turned into subheads of the documents
cutoff <- which(rowSums(is.na(My_R_cheatsheet))==4)

all_tables <- list()

for(i in seq_along(cutoff)){
  if (i == length(cutoff)){
    break
  } else
  table <- tibble(feature = My_R_cheatsheet$feature [(cutoff[i]+1):(cutoff[i+1]-1)],
       package = My_R_cheatsheet$package [(cutoff[i]+1):(cutoff[i+1]-1)],
      syntax = My_R_cheatsheet$`function` [(cutoff[i]+1):(cutoff[i+1]-1)],
      notes = My_R_cheatsheet$notes [(cutoff[i]+1):(cutoff[i+1]-1)],
      references = My_R_cheatsheet$references[(cutoff[i]+1):(cutoff[i+1]-1)])
 all_tables[[i]] <- table
}
# this line prints out the sections in the rmd to copy from console
# cat(str_c("### ", headers$sections, collapse = "\n"))
```

## Writing Functions and loops
Here's [some function help][07]. The basic syntax of a function is 
```{r function syntax, eval=F}
f <- function(<arguments>) {
## Do something interesting
}
```
Trying to write for loops? [R for data science][08] has a great chapter on it.
```{r for loops,eval=F}
output <- vector("double", ncol(df))  # 1. output
for (i in seq_along(df)) {            # 2. sequence
  output[[i]] <- median(df[[i]])      # 3. body
}
```
## Function execution(order, arguments) 
Computer reads scripts in a certain order and it can get confused when you have many arguments. To help organize things, and make your code less confusing for machine and humans to read by bracketing code chunks you wish to execute first `{}`.  

A common usage revolves around `str_match_all`, a function to find strings matching a pattern and whose results is a nested list. In order to access individual capture groups, you will use `str_match_all(data,patter)[,2]`. When you wish to do something about the result, you would likely need to wrap it in brackets like `{str_match_all(data,patter)[,2]}`, so that R knows to treat it as a whole.  

There are certain operators in R that streamline code executation and saves you some typing. For example, `.` can represent the object being passed into a function. For example, if you wish to concatenate a vector with other strings, you can use the syntax `df$col %>% str_c("before",.,"after")` to specify the order of the string placement. Learn more about the `magrittr`'s `.` placeholder [here][11].

## Better printing & Inspection
```{r echo=FALSE}
html_table_width <- function(kable_output, width){
  width_html <- paste0(paste0('<td width="', width, '">'), collapse = "\n")
  sub("<table>", paste0("<table>\n", width_html), kable_output)
}

print_kable <- function (all_tables_i) {
    knitr::kable(
  x = all_tables[[all_tables_i]],
    format = "html", 
  col.names = c("function", "package","syntax","notes","references")) %>% 
  kable_styling(bootstrap_options = c("striped", "hover","responsive","condensed"),fixed_thead = T) %>%  
    row_spec(0, bold = T, color = "white", background = "#8CBEED") %>% 
#for some reason, html doesn't really render the table the way I instructed it to. The columns actually have the same widths. 
    column_spec(1, width = "50px", width_max ="50px") %>%
    column_spec(2, width = "100px", width_max ="100px") %>%
    column_spec(3, width = "50px", width_max ="50px") %>%
    column_spec(4, width = "200px", width_max ="200px") %>% 
    column_spec(5, width = "200px", width_max ="200px")
}
print_kable(1)
```
You're now ready to use functions to solve problems like these:

## Dealing with NAs
```{r echo=FALSE}
print_kable(2)
```
## Data table summary
```{r echo=FALSE}
print_kable(3)
```
## Modify Strings
```{r echo=FALSE, results='asis'}
print_kable(4)
```
## Index & Subsetting
It is very _important_ to note that negative index does not work the same way as the inverse order in Python syntax. In R, the minus sign (-) means to exclude a certain element. As a result, you can use `vector[length(vector)]` to access the last element of a vector.
```{r echo=FALSE}
print_kable(9)
```
## Columns
```{r echo=FALSE}
print_kable(8)
```
## Making a dataframe
```{r echo=FALSE}
print_kable(5)
```
## Ordering
```{r echo=FALSE}
print_kable(12)
```
## Set Operations & Joins
```{r echo=FALSE}
print_kable(10)
```
## Conditions
```{r echo=FALSE}
print_kable(11)
```
## File Paths
```{r echo=FALSE}
print_kable(7)
```
## Batch processing
```{r echo=FALSE}
print_kable(13)
```
## ggplot2
```{r echo=FALSE}
print_kable(6)
```
## R Studio Shortcuts
```{r echo=FALSE}
kable(
x = tibble(what_it_does = pull(My_R_cheatsheet[{cutoff[length(cutoff)]+1}:nrow(My_R_cheatsheet),1]),
       on_the_screen = pull(My_R_cheatsheet[{cutoff[length(cutoff)]+1}:nrow(My_R_cheatsheet),2]),
      you_will_type = pull(My_R_cheatsheet[{cutoff[length(cutoff)]+1}:nrow(My_R_cheatsheet),3]))) %>% 
    kable_styling(bootstrap_options = c("striped", "hover")) %>%  row_spec(0, bold = T, color = "white", background = "#8CBEED")
```

# Good reads

* RMarkdown: [knitr syntax][16].
This cheat sheet was originally a [spreadsheet][13], and you can learn about how I turned it into a rendered html page with the package `knitr` in the Rmd.
* Regex: [regexplain package][09]: a handy tool for using regex in RStudio
* General R: [R for Data Science][15]: Needs no introduction? All the bread and butter of R.

Feel free to use the cheat sheet whatever way you want. If there's any R function you wish to add that could be helpful for data cleaning, please fill out this [google form][12] and I'll add them to this thing.
