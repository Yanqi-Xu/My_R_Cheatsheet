---
title: "My R Cheatsheet"
author: "Yanqi Xu"
updated: "`r Sys.time()`"
output: 
  html_document:
    theme: lumen
    toc: true
    toc_float:
      collapsed: true
      smooth_scroll: true
---
<!-- <style> -->
<!--   .kable_wrapper { -->
<!--     display: block; -->
<!--     font-family: sans-serif; -->
<!--     -webkit-font-smoothing: antialiased; -->
<!--     font-size: 100%; -->
<!--     overflow: auto; -->
<!--     width: 1000px; -->
<!--   } -->
<!--   thead { -->
<!--     background-color: rgb(112, 196, 105); -->
<!--     color: white; -->
<!--     font-weight: normal; -->
<!--     padding: 20px 30px; -->
<!--     text-align: center; -->
<!--   } -->
<!--   tbody { -->
<!--     background-color: rgb(238, 238, 238); -->
<!--     color: rgb(111, 111, 111); -->
<!--     padding: 20px 30px; -->
<!--   } -->
<!--   td, th { -->
<!--     padding: 5px; -->
<!--     border: 1px solid #888 !important; -->
<!-- } -->
<!-- </style> -->

```{r setup, include=FALSE}
library(knitr)
opts_chunk$set(
  eval = TRUE,
  echo = TRUE,
  warning = FALSE,
  message = FALSE,
  error = FALSE,
  # it's nice to un-collapse df print
  collapse = TRUE,
  comment = "#>",
  dpi = 300
)
options(knitr.kable.NA = '')
library(kableExtra)
```

Hi! Welcome to my Data Journalist's R Cheatsheet for cleaning and wrangling data. Just like the [R cheatsheet resources][10] of package-based cheatsheet, Journalists have put out cheatsheets before, like [MaryJo Webster's R Cheatsheet][03]. Hat tip to her and her [amazing collection of data journalism resources][04]!

I use this cheatsheet as an index to functions I will likely encounter and use when I am clenaing data, so I am hoping that it can save you some time googling around. Most of the functions listed here are what I learned for cleaning data at the NICAR data library and at the Investigative Reporting Workshop.

# What's this for?
Much as I use data cleaning functions on a regular basis, the syntax or function names sometimes get fuzzy every once in a while. So I have organized some most frequently used functions to help refresh memories for certain goals in data processing and also pitfalls! Here they are.

# A word about programming
I always think the most important thing to know about functions and to tap into their strengths is to understand what you're dealing with. When I can't write clean code and get it to work, I always take out my pen and pad and jot down what I want to achieve and the end products I wish to have. This basically helps me get a grasp of the object at hand, and break them down into the smallest unit possible, and how these units can form the end products you want. For example, are you trying to  modify a column or add a new column based on an existing column, which are zipped vectors made up of individual elements?

There are, of course, more than one way to **let's not skin a cat**! For example, picture a jumbled field of last name, first name. If you wish to separate the names into different columns, you can either use the `separate()` function to split up the column by a certain character, or you can use regular expression to capture whatever goes before the comma with `str_match("^(.+),")[,2]`, and whatever comes after as  `str_match(",(.+)$")[,2]`. Pick and choose as you wish!

This cheatsheet  doesn't cover the nuts and bolts of R, for which I highly recommend Andrew Ba Tran's tutorial [Journalism with R][02].

[02]: http://learn.r-journalism.com/en/introduction/
[03]: https://mjwebster.github.io/DataJ/R/RCheatSheet.html
[04]: http://mjwebster.github.io/DataJ/
[05]: https://www.stat.berkeley.edu/~statcur/Workshop2/Presentations/functions.pdf
[06]: https://github.com/r-lib/remotes
[07]: https://swcarpentry.github.io/r-novice-inflammation/02-func-R/
[08]: https://r4ds.had.co.nz/r-markdown.html
[09]: https://github.com/gadenbuie/regexplain
[10]: https://rstudio.com/resources/cheatsheets/
# Something about libraries
Since other people have spent all this time writing functions and packaged them, we use their functions by calling the package names (which may take developers a lot of time to come up with) first in the R console or scripts. It's important to declare the packages used at the top of your R Markdown or R scripts file, especially if you knit the file (in order to generate a standalone html for the Rmd in a readable format), otherwise it will throw a bunch of errors. 
This also assumes that you have the packages installed already. If you wish to install new packages, use `install.packages("packagename")` first or use the packages pane to manage your packages (by default, the lower right-hand side pane). If you are trying to install a package that is not on CRAN yet and couldn't be installed by using the `install.packages("packagename")` function, use the [remotes][06] package's `remotes::install_github("r-lib/remotes")`. The double colons help you run a function from a certain package, use "{package_name}::{function_name}". I am sure that you have figured out that `remotes` is on CRAN, so that it can be installed, with the command `install.packages('remotes')`. 

```{r}
library(tidyverse)
```
# Something about functions
Functions are just objects. They exist in those packages!
So if you want ot know more about functions themselves, call them by their names, without parathenses in the console. 
For the documentation, type "?" followed by the function name, will give you its documentation laid out in the help window. Try `?str_split`. 
For how the function was written to make sense of how it's executed, simply type the name of the function. Like `str_split`.
Further Readings:
[Introduction to the R Language Functions, Berkeley Workshop][05]
```{r echo = FALSE}
My_R_Cheatsheet <- read_csv("My_R_Cheatsheet.csv")

headers <- My_R_Cheatsheet %>% filter(rowSums(is.na(My_R_Cheatsheet))==4)

headers <- headers %>% mutate(sections = coalesce(headers[[1]],headers[[3]]))

cutoff <- which(rowSums(is.na(My_R_Cheatsheet))==4)

all_tables <- list()

for(i in seq_along(cutoff)){
  if (i == length(cutoff)){
    break
  } else
  table <- tibble(feature = My_R_Cheatsheet$feature [(cutoff[i]+1):(cutoff[i+1]-1)],
       package = My_R_Cheatsheet$package [(cutoff[i]+1):(cutoff[i+1]-1)],
      syntax = My_R_Cheatsheet$`function` [(cutoff[i]+1):(cutoff[i+1]-1)],
      notes = My_R_Cheatsheet$notes [(cutoff[i]+1):(cutoff[i+1]-1)],
      references = My_R_Cheatsheet$references[(cutoff[i]+1):(cutoff[i+1]-1)])
 all_tables[[i]] <- table
}
# this line prints out the sections in the rmd to copy from console
# cat(str_c("### ", headers$sections, collapse = "\n"))
```

### Better printing & Inspection
```{r echo=FALSE}
html_table_width <- function(kable_output, width){
  width_html <- paste0(paste0('<col width="', width, '">'), collapse = "\n")
  sub("<table>", paste0("<table>\n", width_html), kable_output)
}

print_kable <- function (all_tables_i) {
    kable(
  x = all_tables[[all_tables_i]],
    format = "html", 
  col.names = c("function", "package","syntax","notes","references")) %>% 
  kable_styling(bootstrap_options = c("striped", "hover"),full_width = F, position = "left", fixed_thead = T) %>%  row_spec(0, bold = T, color = "white", background = "#8CBEED") %>% 
    column_spec(1, width = "10em") %>% 
    html_table_width(c(200,200,400,400, 200))
}

print_kable(1)
```

### Dealing with NAs
```{r echo=FALSE}
print_kable(2)
```
### Data table summary
```{r echo=FALSE}
print_kable(3)
```
### Modify Strings
```{r echo=FALSE}
print_kable(4)
```
### Index & Subsetting
It is very _important_ to note that negative index does not work the same way as the inverse order in Python syntax. In R, the minus sign (-) means to exclude a certain element. As a result, you can use `vector[length(vector)]` to access the last element of a vector.
```{r echo=FALSE}
print_kable(9)
```
### Columns
```{r echo=FALSE}
print_kable(8)
```
### Making a dataframe
```{r echo=FALSE}
print_kable(5)
```
### Ordering
```{r echo=FALSE}
print_kable(12)
```
### Set Operations & Joins
```{r echo=FALSE}
print_kable(10)
```
### Conditions
```{r echo=FALSE}
print_kable(11)
```
### File Paths
```{r echo=FALSE}
print_kable(7)
```
### Batch processing
```{r echo=FALSE}
print_kable(13)
```
### ggplot2
```{r echo=FALSE}
print_kable(6)
```
### R Studio Shortcuts
```{r echo=FALSE}
kable(
x = tibble(what_it_does = as.character(My_R_Cheatsheet [cutoff[length(cutoff)]+1:length(My_R_Cheatsheet),1]),
       on_the_screen = as.character(My_R_Cheatsheet [cutoff[length(cutoff)]+1:length(My_R_Cheatsheet),2]),
      you_will_type = as.character(My_R_Cheatsheet [cutoff[length(cutoff)]+1:length(My_R_Cheatsheet),3]))) %>% 
    kable_styling(bootstrap_options = c("striped", "hover")) %>%  row_spec(0, bold = T, color = "white", background = "#8CBEED")
```

### Functions and loops
Here's [some function help][6]. The basic syntax of a function is 
```{r function syntax, eval=F}
f <- function(<arguments>) {
## Do something interesting
}
```
Trying to write for loops? [R for data science][07] has a great chapter on it.
```{r for loops,eval=F}
output <- vector("double", ncol(df))  # 1. output
for (i in seq_along(df)) {            # 2. sequence
  output[[i]] <- median(df[[i]])      # 3. body
}
```

## Good reads
* RMarkdown: [knitr syntax][08]
* Regex: [regexplain package][09]: a handy tool for using regex in RStudio